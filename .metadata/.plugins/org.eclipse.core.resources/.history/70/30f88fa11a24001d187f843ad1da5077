&НаКлиенте
Процедура Команда1(Команда)
	Команда1НаСервере();
КонецПроцедуры

&НаСервере
Процедура Команда1НаСервере()
	
	СправчникОбъект = РеквизитФормыВЗначение("Объект");
	СправчникОбъект.ФорматироватьНаименование();
	ЗначениеВРеквизитФормы(СправчникОбъект,"Объект");
	
	СправчникОбъект = ДанныеФормыВЗначение(Объект,Тип("СправочникОбъект.Контрагенты"));
	СправчникОбъект.ФорматироватьНаименование();
	ЗначениеВДанныеФормы(СправчникОбъект,Объект);
	
КонецПроцедуры

//&НаКлиенте
//Процедура УстановитьВидимостьПолей()
//	
//	Если Объект.ЮридическоеФизическоеЛицо = ПредопределенноеЗначение("Перечисление.ЮридическоеФизическоеЛицо.ЮридическоеЛицо") Тогда
//		Элементы.ДокументУдостоверяющийЛичность.Видимость = Ложь;
//		Элементы.КПП.Видимость = Истина;
//		Элементы.ОГРН.Видимость = Истина;
//	Иначе
//		Элементы.ДокументУдостоверяющийЛичность.Видимость = Истина;
//		Элементы.КПП.Видимость = Ложь;
//		Элементы.ОГРН.Видимость = Ложь;
//	КонецЕсли;     
//	
//КонецПроцедуры // ()

&НаКлиенте
Процедура ЮридическоеФизическоеЛицоПриИзменении(Элемент)
	УстановитьВидимостьПолей();
КонецПроцедуры

//&НаКлиенте
//Процедура ПриОткрытии(Отказ)
//	УстановитьВидимостьПолей();
//КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьПолей()
	
	Если Объект.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ЮридическоеЛицо Тогда
		Элементы.ДокументУдостоверяющийЛичность.Видимость = Ложь;
		Элементы.КПП.Видимость = Истина;
		Элементы.ОГРН.Видимость = Истина;
	Иначе
		Элементы.ДокументУдостоверяющийЛичность.Видимость = Истина;
		Элементы.КПП.Видимость = Ложь;
		Элементы.ОГРН.Видимость = Ложь;
	КонецЕсли;

КонецПроцедуры // ()

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьВидимостьПолей();
	УстановитьЗначениеПараметровФО();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьЗначениеПараметровФО()

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПараметрыКонтекстныхФункциональныхОпций.Ссылка
		|ИЗ
		|	Справочник.ПараметрыКонтекстныхФункциональныхОпций КАК ПараметрыКонтекстныхФункциональныхОпций
		|ГДЕ
		|	ПараметрыКонтекстныхФункциональныхОпций.ВестиУчетПоДоговорам = &ВестиУчетПоДоговорам
		|	И ПараметрыКонтекстныхФункциональныхОпций.ВестиУчетПоДоговорам = &ВестиОтгрузки";
	
	Если ПолучитьФункциональнуюОпцию("УчетПоДоговорамГлобальнаяОпция") = Истина Тогда //Если установлена глобальна ФО, то не ведем учет по договорам
		Запрос.УстановитьПараметр("ВестиУчетПоДоговорам", Объект.ВестиУчетПоДоговорам);
	Иначе 
		Запрос.УстановитьПараметр("ВестиУчетПоДоговорам", Ложь);
	КонецЕсли;
	
	Если Объект.ТипКонтрагента = 1 Тогда
		ВестиОтгрузки = Истина;
	Иначе
		ВестиОтгрузки = Ложь;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ВестиОтгрузки", ВестиОтгрузки);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Если ВыборкаДетальныеЗаписи.Следующий() Тогда
		
		НастройкаФормы = ВыборкаДетальныеЗаписи.Ссылка;
		
	Иначе
		
		НоваяНастройкаФормы = Справочники.ПараметрыКонтекстныхФункциональныхОпций.СоздатьЭлемент();
		НоваяНастройкаФормы.ВестиУчетПоДоговорам = Объект.ВестиУчетПоДоговорам;
		НоваяНастройкаФормы.ВестиОтгрузки = ВестиОтгрузки;
		НоваяНастройкаФормы.Записать();
		
		НастройкаФормы = НоваяНастройкаФормы.Ссылка;		
	
	КонецЕсли;	
	
	ПараметрыФункциональныхОпций = Новый Структура;
	ПараметрыФункциональныхОпций.Вставить("НастройкаФормы", НастройкаФормы);
	
	УстановитьПараметрыФункциональныхОпцийФормы(ПараметрыФункциональныхОпций);	
	
КонецПроцедуры

&НаКлиенте
Процедура ТипКонтрагентаПриИзменении(Элемент)
	
	УстановитьЗначениеПараметровФО();
	
КонецПроцедуры


&НаКлиенте
Процедура ВестиУчетПоДоговорамПриИзменении(Элемент)
	
	УстановитьЗначениеПараметровФО();
	
КонецПроцедуры














